<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>RAJI'S SAREES</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <!-- <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}"> -->

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

    <link rel="stylesheet"
      href="{{ url_for('static', filename='css/admin-premium.css') }}">

</head>
<body>
  <!-- FLASH TOAST -->
  <div class="toast-container position-fixed top-0 end-0 p-3">
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-success alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}
  </div>

<!-- ================= NAVBAR ================= -->
<nav class="navbar navbar-expand-lg bg-white shadow-sm sticky-top">
  <div class="container">

    <!-- LOGO -->
    <a class="navbar-brand fw-bold brand-logo" href="/">RAJI‚ÄôS SAREES</a>

    <!-- TOGGLER -->
    <button class="navbar-toggler" type="button"
            data-bs-toggle="collapse"
            data-bs-target="#mainNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- MENU -->
    <div class="collapse navbar-collapse" id="mainNavbar">
      <ul class="navbar-nav ms-auto align-items-lg-center gap-lg-3">

        {% if current_user.is_authenticated %}

          {% if current_user.is_admin %}
            <li class="nav-item">
              <a href="/admin/dashboard" class="nav-link fw-bold text-danger">Admin</a>
            </li>
          {% endif %}

          <li class="nav-item">
            <a href="/wishlist" class="nav-link">‚ù§Ô∏è Wishlist</a>
          </li>

          <li class="nav-item position-relative">
            <a href="/cart" class="nav-link">
              üõí Cart
              {% if cart_count > 0 %}
                <span class="badge bg-danger position-absolute top-0 start-100 translate-middle">
                  {{ cart_count }}
                </span>
              {% endif %}
            </a>
          </li>

          <li class="nav-item">
            <a href="/orders" class="nav-link">Orders</a>
          </li>

          <li class="nav-item">
            <a href="/logout" class="nav-link">Logout</a>
          </li>

        {% else %}

          <li class="nav-item">
            <a href="/login" class="nav-link">Login</a>
          </li>

          <li class="nav-item">
            <a href="/register" class="nav-link">Register</a>
          </li>

        {% endif %}

      </ul>
    </div>
  </div>
</nav>

<!-- PAGE CONTENT -->
<div class="container mt-4">
  {% block content %}
  <div class="admin-wrapper">

    <!-- HEADER -->
    <div class="admin-header d-flex justify-content-between align-items-center mb-4">
      <div>
        <h2 class="mb-1">üëë Admin Dashboard</h2>
        <small>Manage Raji's Sarees Store</small>
      </div>

      <a href="{{ url_for('admin_add_product') }}"
        class="btn btn-add">
        ‚ûï Add Product
      </a>
    </div>

    <!-- TABLE -->
    <div class="table-responsive admin-table">
      <table class="table table-bordered align-middle">
        <thead>
          <tr>
            <th>Image</th>
            <th>Product</th>
            <th>Price</th>
            <th>Stock</th>
            <th>Update</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>
          {% for product in products %}
          <tr>

            <!-- IMAGE -->
            <td>
                <img
            src="{{ url_for('static',
                  filename='uploads/' ~ product.name|lower|replace(' ', '') ~ '.jpg') }}"
            class="img-fluid product-img w-100"
            alt="{{ product.name }}"
            loading="lazy"
            onerror="this.onerror=null;this.src='/static/uploads/cottonhandloomsaree.jpg';"
          >
            </td>

            <!-- NAME -->
            <td>
              <strong>{{ product.name }}</strong><br>
              <small class="text-muted">{{ product.description }}</small>
            </td>

            <!-- PRICE -->
            <td>
              <del class="text-muted">‚Çπ{{ product.mrp }}</del><br>
              <strong>‚Çπ{{ product.price }}</strong>
            </td>

            <!-- STOCK -->
            <td>
              {% if product.stock > 10 %}
                <span class="badge bg-success">{{ product.stock }}</span>
              {% elif product.stock > 0 %}
                <span class="badge bg-warning text-dark">{{ product.stock }}</span>
              {% else %}
                <span class="badge bg-danger">Out</span>
              {% endif %}
            </td>

            <!-- UPDATE STOCK -->
            <td>
              <form method="POST"
                    action="/admin/update-stock/{{ product.id }}"
                    class="admin-stock-form">

                <input type="number"
                      name="stock"
                      min="0"
                      class="form-control form-control-sm"
                      placeholder="Qty"
                      required>

                <button class="btn btn-primary btn-sm">
                  ‚úî
                </button>
              </form>
            </td>

            <!-- ACTIONS -->
            <td>
              <div class="admin-actions">
                <a href="/admin/product/edit/{{ product.id }}"
                  class="btn btn-warning btn-sm">
                  ‚úèÔ∏è
                </a>

                <a href="/admin/product/delete/{{ product.id }}"
                  class="btn btn-danger btn-sm"
                  onclick="return confirm('Delete this product?')">
                  üóë
                </a>
              </div>
            </td>

          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>
  {% endblock %}
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Auto close alerts -->
<script>
  setTimeout(() => {
    document.querySelectorAll('.alert').forEach(alert => {
      new bootstrap.Alert(alert).close();
    });
  }, 3000);

</script>

</body>
</html>
